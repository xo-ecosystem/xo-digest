[tox]
envlist = py311, lint, cz, release

[testenv]
deps =
    mypy==1.10.0
    pytest==8.2.2
    pre-commit==3.7.0
    commitizen==3.17.0
commands =
    pytest --tb=short --disable-warnings

[testenv:lint]
skipsdist = true
deps = pre-commit==3.7.0
commands = pre-commit run --all-files --show-diff-on-failure

[testenv:cz]
skipsdist = true
skip_install = true
deps =
    commitizen==3.17.0
allowlist_externals = pytest
commands =
    pytest --tb=short --disable-warnings
    cz changelog --dry-run || true

[testenv:release]
skipsdist = true
skip_install = true
deps =
    commitizen==3.17.0
commands =
    pytest --tb=short --disable-warnings
    cz bump --yes --changelog
    xo-fab vault.archive
    bash scripts/upload_to_arweave.sh
    curl -s -X POST http://localhost:8000/sign-all || true
    echo "âœ… Post-release actions complete." >> vault/vault.log

[testenv:archive]
skipsdist = true
skip_install = true
deps =
    tox
commands =  
    xo-fab vault.archive

[testenv:cz]
deps =
    coverage
    pytest-cov
commands =
    pytest --cov=vault --cov-report=term-missing --tb=short --disable-warnings

commands_pre =
    pytest --tb=short --disable-warnings --cov=.

